#! /bin/sh

#   ip_addresses - print tight regular expressions for IPv4 and IPv6 addresses
#   Copyright (C) 2018-2020  Erik Auerswald
#
#   This program is free software: you can redistribute it and/or modify
#   it under the terms of the GNU General Public License as published by
#   the Free Software Foundation, either version 3 of the License, or
#   (at your option) any later version.
#
#   This program is distributed in the hope that it will be useful,
#   but WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#   GNU General Public License for more details.
#
#   You should have received a copy of the GNU General Public License
#   along with this program.  If not, see <http://www.gnu.org/licenses/>.

# verify IPv4 and IPv6 addresses using regular expressions
# accept addresses with or without CIDR prefix length
# this script tests the regular expressions defined therein
#
# CAUTION: the regular expressions contain '/' characters
#          -> use a different character, e.g. ',', for sed and similar tools

echo "Defining regular expressions for matching IPv4 and IPv6 addresses."
# IPv4 regular expression
dot_quad='(((1?[0-9]{1,2})|(2[0-4][0-9])|(25[0-5]))\.){3}((1?[0-9]{1,2})|(2[0-4][0-9])|(25[0-5]))(/([0-9]|([12][0-9])|(3[0-2])))?'
IPv4_CIDR='/([0-9]|([12][0-9])|(3[0-2]))'
IPv4="${dot_quad}(${IPv4_CIDR})?"

# IPv6 regular expression
IPv6_CIDR='/(([0-9]?[0-9])|(1[0-1][0-9])|(12[0-8]))'
IPv6_long='([[:xdigit:]]{1,4}:){7}[[:xdigit:]]{1,4}'
IPv6_short0='::(([[:xdigit:]]{1,4}:){0,6}[[:xdigit:]]{1,4})?'
IPv6_short1='[[:xdigit:]]{1,4}::(([[:xdigit:]]{1,4}:){0,5}[[:xdigit:]]{1,4})?'
IPv6_short2='([[:xdigit:]]{1,4}:){2}:(([[:xdigit:]]{1,4}:){0,4}[[:xdigit:]]{1,4})?'
IPv6_short3='([[:xdigit:]]{1,4}:){3}:(([[:xdigit:]]{1,4}:){0,3}[[:xdigit:]]{1,4})?'
IPv6_short4='([[:xdigit:]]{1,4}:){4}:(([[:xdigit:]]{1,4}:){0,2}[[:xdigit:]]{1,4})?'
IPv6_short5='([[:xdigit:]]{1,4}:){5}:(([[:xdigit:]]{1,4}:){0,1}[[:xdigit:]]{1,4})?'
IPv6_short6='([[:xdigit:]]{1,4}:){6}:([[:xdigit:]]{1,4})?'
IPv6_short7='([[:xdigit:]]{1,4}:){7}:'
IPv6_quad0="([[:xdigit:]]{1,4}:){6}${dot_quad}"
IPv6_quad1="::([[:xdigit:]]{1,4}:){0,5}${dot_quad}"
IPv6_quad2="[[:xdigit:]]{1,4}::([[:xdigit:]]{1,4}:){0,4}${dot_quad}"
IPv6_quad3="([[:xdigit:]]{1,4}:){2}:([[:xdigit:]]{1,4}:){0,3}${dot_quad}"
IPv6_quad4="([[:xdigit:]]{1,4}:){3}:([[:xdigit:]]{1,4}:){0,2}${dot_quad}"
IPv6_quad5="([[:xdigit:]]{1,4}:){4}:([[:xdigit:]]{1,4}:){0,1}${dot_quad}"
IPv6_quad6="([[:xdigit:]]{1,4}:){5}:${dot_quad}"
# allow zone IDs for multicast, site-local, and link-local IPv6 addresses,
# i.e., ff00::/8, fe80::/10, and fec0/10 (fe80/9)
# link-local includes FE80::/10, not just FE80::/64
IPv6_zone_pre='(([fF]{2}[[:xdigit:]]{2})|([fF][eE][89ABCDEFabcdef][[:xdigit:]]))'
# zone IDs are arbitrary character strings
IPv6_zone_id='%(([^/][^%]*)|(/[^%]*[^0-9%][^%]*))'
IPv6_z_l='([[:xdigit:]]{1,4}:){6}[[:xdigit:]]{1,4}'
IPv6_z_s0='::(([[:xdigit:]]{1,4}:){0,5}[[:xdigit:]]{1,4})?'
IPv6_z_s1='[[:xdigit:]]{1,4}::(([[:xdigit:]]{1,4}:){0,4}[[:xdigit:]]{1,4})?'
IPv6_z_s2='([[:xdigit:]]{1,4}:){2}:(([[:xdigit:]]{1,4}:){0,3}[[:xdigit:]]{1,4})?'
IPv6_z_s3='([[:xdigit:]]{1,4}:){3}:(([[:xdigit:]]{1,4}:){0,2}[[:xdigit:]]{1,4})?'
IPv6_z_s4='([[:xdigit:]]{1,4}:){4}:(([[:xdigit:]]{1,4}:){0,1}[[:xdigit:]]{1,4})?'
IPv6_z_s5='([[:xdigit:]]{1,4}:){5}:([[:xdigit:]]{1,4})?'
IPv6_z_q0="([[:xdigit:]]{1,4}:){5}${dot_quad}"
IPv6_z_q1="::([[:xdigit:]]{1,4}:){0,4}${dot_quad}"
IPv6_z_q2="[[:xdigit:]]{1,4}::([[:xdigit:]]{1,4}:){0,3}${dot_quad}"
IPv6_z_q3="([[:xdigit:]]{1,4}:){2}:([[:xdigit:]]{1,4}:){0,2}${dot_quad}"
IPv6_z_q4="([[:xdigit:]]{1,4}:){3}:([[:xdigit:]]{1,4}:){0,1}${dot_quad}"
IPv6_z_q5="([[:xdigit:]]{1,4}:){4}:${dot_quad}"
IPv6="(((${IPv6_long})|(${IPv6_short0})|(${IPv6_short1})|(${IPv6_short2})|(${IPv6_short3})|(${IPv6_short4})|(${IPv6_short5})|(${IPv6_short6})|(${IPv6_short7})|(${IPv6_quad0})|(${IPv6_quad1})|(${IPv6_quad2})|(${IPv6_quad3})|(${IPv6_quad4})|(${IPv6_quad5})|(${IPv6_quad6}))|(${IPv6_zone_pre}((${IPv6_z_l})|(${IPv6_z_s0})|(${IPv6_z_s1})|(${IPv6_z_s2})|(${IPv6_z_s3})|(${IPv6_z_s4})|(${IPv6_z_s5})|(${IPv6_z_q0})|(${IPv6_z_q1})|(${IPv6_z_q2})|(${IPv6_z_q3})|(${IPv6_z_q4})|(${IPv6_z_q5}))(${IPv6_zone_id})))(${IPv6_CIDR})?"

# test the regular expressions
TMPFILE=$(mktemp) || { echo "ERROR: could not create temporary file."; exit 1; }
trap "rm -f $TMPFILE" 0 1 2 3 15
cat > "$TMPFILE" << EOAdressen
%%%% correct IP adresses (version 4 and 6) %%%%
0.0.0.0
0.0.0.0/0
0.0.0.0/1
1.2.3.4/31
1.2.3.4/32
192.168.0.1
10.0.0.1/8
10.100.11.254/24
172.16.10.1/25
131.246.124.65/26
0.0.0.0/8
0.0.0.0/32
10.0.0.0/8
127.0.0.0/8
127.0.0.1
127.0.0.2
169.254.0.0/16
172.16.0.0/12
192.0.0.0/24
192.0.2.0/24
192.88.99.0/24
192.88.99.1
192.168.0.0/16
198.18.0.0/15
198.51.100.0/24
203.0.113.0/24
224.0.0.0/4
240.0.0.0/4
255.255.255.255/32
100.64.0.0/10
131.246.199.16/30
131.246.199.18
131.246.197.0/25
131.246.197.0/26
131.246.197.64/27
131.246.197.96/28
131.246.197.112/28
10.122.0.0/24
10.122.96.0/24
213.239.193.212
78.46.223.160/29
224.0.0.0
224.0.0.1
224.0.0.2
224.0.0.4
224.0.0.5
224.0.0.6
224.0.0.9
224.0.0.10
224.0.0.13
224.0.1.0/24
224.0.1.39
224.0.1.40
224.0.2.0
224.0.255.0
224.0.255.255
239.0.0.0
239.255.255.255
239.192.0.0
239.251.255.255
239.252.0.0
239.254.255.255
255.255.255.255
2001:638:208:ef34:0:ff:fe00:74/64
fe80::52:46ff:fec6:818f/64
::
::/0
::1
0::1
0::1/128
0::0/0
2001:0db8:85a3:0000:0000:8a2e:0370:7334
2001:db8:85a3:0:0:8a2e:370:7334
2001:db8:85a3::8a2e:370:7334
2001:db8:85a3::8a2e:7334
2001:db8:85a3::8a2e
2001::8a2e:370:7334
2001:85a3::8a2e:370:7334
0:0:0:0:0:0:0:1
0:0:0:0:0:0:0:0
::ffff:c000:280
::ffff:192.0.2.128
0:0:0000:0000:0:ffff:192.0.2.128
0:0:0:0::ffff:192.0.2.128
0:0:0::ffff:192.0.2.128
0:0::ffff:192.0.2.128
0::ffff:192.0.2.128
::/128
::/0
::1/128
fe80::/10
fe80::/64
fc00::/7
::ffff:0:0/96
::FFFF:0:0/96
::ffff:0:0:0/96
::ffff:10.1.0.1
::ffff:10.1.0.1/128
fc00::10:1:0:1
fc00::10:2:34:0/112
::ffff:0a01:0001
64:ff9b::/96
64:FF9B::/96
2002::/16
2001:0000::/29
2001:01f8::/29
2001:0000::/32
2001::/32
2001:2::/48
2001:10::/28
2001:db8::/32
ff00::0/12
ff01::1
ff02::1
ff01::2
ff02::2
ff05::1
ff05::2
ff02::5
ff02::6
ff02::9
ff02::a
ff02::b
ff02::c
ff02::d
FF02::A
FF02::B
FF02::C
FF02::D
FF02::16
ff01::fb
ff01::101
ff02::1:1
ff02::1:2
ff02::1:3
ff05::1:3
ff02::1:ff00:0/104
ff02::2:ff00:0/104
dead:BEAF::
::dEaD:BeAf
deAD::BEaf
FE80::5EFE:10.23.1.5
::FFFF:10.23.1.5
FEC0:0:0:1::10.23.1.5
2002:0A17:0105::/48
2001:DB8::/32
ABCD:EF01:2345:6789:ABCD:EF01:2345:6789
2001:DB8:0:0:8:800:200C:417A
2001:DB8::8:800:200C:417A
FF01:0:0:0:0:0:0:101
FF01::101
0:0:0:0:0:0:13.1.68.3
0:0:0:0:0:FFFF:129.144.52.38
::13.1.68.3
::FFFF:129.144.52.38
2001:0DB8:0000:CD30:0000:0000:0000:0000/60
2001:0DB8::CD30:0:0:0:0/60
2001:0DB8:0:CD30::/60
2001:0DB8:0:CD30:123:4567:89AB:CDEF
2001:0DB8:0:CD30:123:4567:89AB:CDEF/60
FF00::/8
FE80::/10
2001:0DB8:0000:0001:0000:0000:0010:01FF
2001:0DB8:0000:0001::0010:01FF
2001:DB8:0:1::10:1FF
0000::/8
0000::/96
0064:ff9b::/96
064:ff9b::/96
0200::/7
2001:Db8::/32
2001:0000::/32
2001:0010::/28
2001:0002::/48
3FFE:831F::/32
FC00::/7
FC00::/8
FD00::/8
FEC0::/10
ff00::/8
FF05::2
0000::/8
0100::/8
0200::/7
0400::/6
0800::/5
1000::/4
2000::/3
4000::/3
6000::/3
8000::/3
A000::/3
C000::/3
E000::/4
F000::/5
F800::/6
FE00::/9
fF00::/8
CAFE:1::1/64
::/96
::ffff:0:0/96
::ffff:0.0.0.0/96
3ffe::/16
FF02:0:0:0:0:2:FF00::/104
FF02::2:FF00:0/104
::ffff:127.0.0.0/104
0001:0000:0000:0000:0000:0000:0000:0000/48
0::/8
1::/48
::/48
::ffff:0.0.0.0/104
1::1/64
2031:0000:130F:0000:0000:09C0:876A:130B
2031:0:130f::9c0:876a:130b
FF01:0:0:0:0:0:0:1
2001::/16
3FFF::/16
fe80::206:5bff:fe30:bbd2
::192.168.20.1
::C0A8:1E01
FE80::0800:2001:c782
FF02::1:FF01:c782
2001:DB8:2222:7272::72/64
2001:DB8:2222:7272::/64
2001:DB8:2222:7272:000B:5DFF:FE72:7A3A/64
FE80::1
2001::/64
fe80::5efe:10.47.181.92
fe80::3521:12fa:2c44:87d1
fe80::208:74ff:feda:625c
2001:db8:d005:f282:ed46:5dd4:5439:2e1c
2001:db8:d005:f282:3521:12fa:2c44:87d1
fd4a:3a9:27a1:f282:ed46:5dd4:5439:2e1c
fd4a:3a9:27a1:f282:3521:12fa:2c44:87d1
fec0::/10
2001:0DB8:3000:3000::42
2001:DB8:1263::/48
13::/64
2001:1:1:1::/64
3ffe:b00:800:1::3/127
3ffe:153:AFFE:2::1/126
ff02::5678%5
ff02::5678%pvc1.3
ff08::9abc%10
ff08::9abc%interface10
fe80::1234%1
fe80::1234%ne0
fe80::2%3
fe80::%2/64
FE80::C801:1AFF:FE97:8%FastEthernet0/0
fe80::5efe:192.168.41.30%10
fe80::206:5bff:fe30:bbd2%eth0
fe80::206:5bff:fe30:bbd2%12
fe80::210:5aff:feaa:20a2%4
fe80::260:97ff:fe02:6ea5%4
fe80::5efe:10.47.181.92%17
fe80::5efe:10.47.181.92%0
fe80::3521:12fa:2c44:87d1%8
fe80::208:74ff:feda:625c%5
fe80::208:74ff:feda:625c%0
FF30::/12
ff30::/12
Ff30::/12
fF30::/12
FF70::/12
ff70::/12
Ff70::/12
fF70::/12
FF02:0:0:0:0:1:FF00:0000/104
ff02:0:0:0:0:1:ff00:0000/104
Ff02::1:fF00:0
2037::01:800:200E:8C6C
FF02::1:FF0E:8C6C
2001:DB8:9696::/64
2001:DB8::abf:1:7
::FFFF:127.0.0.1
2001:db8:1:2:a:b:c:0/127
2001:db8:1:2:a:b:c:1/127
2001:db8:1:2::1/64
2001:db8:1:2::2/64
2001:db8:1:2::3
3ffe:ffff::1/127
3ffe:ffff::1
3ffe:ffff::0/127
3ffe:ffff::0
::FFFF:152.78.1.1
fd00::/48
fd00::/56
fd00::/64
fd00:0:0:1::/64
fd00:0:0:2::/64
2001:DB80::/48
2001:DB80:0:1::/64
2001:DB80:0:2::/64
2001:DB80:0:3::/64
2001:638:208:fdc0::/64
2001:638:208:FDC0::2
2001:638:208:cd00::/56
2a01:4f8:130:53c4::/64
fdbd:e109:c5b4::3e07:54ff:fe3f:daff
fdbd:e109:c5b4::1/64
e80::c43d:c7ff:fe9d:e39a/64
fdbd:e109:c5b4:2::1/64
fe80::c63d:c7ff:fe9d:e39a/64
2001::
2001:0:0:0:0DB8:0:0:417A
2001::DB8:0:0:417A
0:0:0:0:0:0:192.168.30.1
::192.168.30.1
::C0A8:1E01
2031:0000:130F:0000:0000:09C0:876A:130B
2031:0:130F:0:0:09C0:876A:130B
2031:0:130F::9C0:876A:130B
::0A43:0002
::10.67.0.2
0:0:0:0:0:0:10.67.0.2
FE80:0:0:0:10::123
FE80::10:0:0:123
3000:1234:5678::/48
2340::/12
ff02::2%se00
ff02::1%se00
FF02::12
2005:0:DEAD:BEEF:2DD:1FF:FE1C:DB80
FE80::2DD:1FF:FE1C:DB80
FE80::5
FC00::/8
FD00::/8
2005:0:DEAD:BEEF::1/64
ff05::1:3
2005:dead:beef:a1::/64
2005:dead:beef:b1::53
2005:dead:beef:b2::53
2005:DEAD:BEEF:C100::1/64
2005:DEAD:BEEF:D100::/56
2005:DEAD:BEEF:C100::2/64
::1:0:0:0:1/64
::192.168.14.1
::192.168.199.2
224.0.0.0/8
224.0.0.1
224.0.0.2
224.0.0.5
224.0.0.6
224.0.0.9
224.0.0.10
FE80::5:73FF:FFA0:42
FE80::200:CFF:FEF6:52CD
FE80::7:B4FF:FE04:200
2005:dead:beef:c100::1
2002:C0A8:C701::/48
2002:C0A8:C702::
FE80::5EFE:C0A8:C701
2005:DEAD:BEEF::/64
ff02::521
2005:dead:beef::/48
FF7E:0164:2005:DEAD:BEEF:00C1:1001::/96
0000::/8
001:15A8:A:1:FFFF:FFFF:FFFF:2
2001:0000::/23
2001:0000::/32
2001:0200::/23
2001:0400::/23
2001:0600::/23
2001:0660:010a:4002:4421:21FF:FE24:87c1
2001:0660:3000::/40
2001:0660:3300::/40
2001:0660:4400::/40
2001:0660:4700::/40
2001:0660:4701::/48
2001:0660:4702::/48
2001:0660:5400::/40
2001:0660::/32
2001:678::/29
2001:0738:0::/36
2001:0738:2000::/44
2001:0738:5000::/44
2001:0738:58::/44
2001:0738:6000::/44
2001:0738:7000::/44
2001:0738:7800::/44
2001:0760::/32
2001:0800::/23
2001:0A00::/23
2001:0C00::/23
2001:0DB8:3003:0001:0000:0000:6543:210F
2001:0E00::/23
2001:1200::/23
2001:1578:0:FF::1
2001:1578:0:FFFF::1
2001:1578:0:FFFF::2
2001:15A8:A:1:FFFF:FFFF:FFFF:3
2001:15A8:A:1:FFFF:FFFF:FFFF:4
2001:15A8:A:1:FFFF:FFFF:FFFF:5
2001:470:1F01:FFFF::224
2001:470:1F01:FFFF::225
2001:660:3001:104::8
2001:660:3003:2:a00:20ff:fe18:964c/64
2001:660:3003::/48
2001:660:3006:1::1:1
2001:660:7301:1::1
2001:660::/32
2001:690:1:1:0E:0CFF:FE31:C81F
2001:690:1fff:200:20e:cff:fe31:c81f
2001:690:5:0::10
2001::/16
2001:DB8:10::beef/48
2001:DB8:1:2::1
2001:DB8:1:2::100
2001:DB8:20::291D:6A83/48
2001:DB8:20::922:A678
2001:DB8:3003:1::6543:210F
2001:DB8::43
2001:bf0:000::/35
2001:db8:1:1::
2001:db8:1:1::1600
2001:db8::/32
2001:db8:dead:beef::cafe
2002::/16
2002:c000:0101::/48
2003::/16
2006:151:2:0:20C:29FF:FEB9:8D7C
2006:151:2:0:20c:29ff:feb9:8d7c
2006:151:3:0:20D:60FF:FEFA:E15B
2006:151:3:0:20d:60ff:fefa:e15b
2006:1::20C:29FF:FEB9:8D7C
2006:1::20D:60FF:FEFA:E15B
2006:1::20c:29ff:feb9:8d7c
2006:1::20d:60ff:fefa:e15b
2006:1::7/64
2010:836B:4179::836B:4179
2037::01:800:200E:8C6C
FF02::1:FF0E:8C6C
3FFE:1001:1:F036::1
3FFE:1001:1:F036::2
3ffe:2a00:100:7031::1
3ffe::/16
::192.9.5.5
::9
::FFFF:134.1.68.3
::ffff:152.78.64.1
CA5A:4::9
CA5A:4::BB4/64
D093::/64
D093::1/64
FE80::20C:29FF:FEB9:8D7C
FE80::20D:60FF:FEFA:E15B
FE80::20E:0CFF:FE31:C81F
FE80::20F:23FF:FEf0:551A
FE80::20F:35FF:FE2D:38C9
FEDC:BA98:7654:3210:FEDC:BA98:7654:3210
FF01:0:0:0:0:0:0:101
FF02:0000:0000:0000:0000:0001:FF00:0000/104
FF02:0000:0000:0000:0000:0001:FF24:87c1
FF02:0:0:0:0:0:0:1
FF02:0:0:0:0:0:0:101
FF02:0:0:0:0:0:0:2
FF02:0:0:0:0:0:0:D
FF05:0:0:0:0:0:0:101
FF05:0:0:0:0:0:0:2
FF0E:0:0:0:0:0:0:101
FF0E::1234
FF3E:20:2001:660:0:0:1234:abcd
FF3E:40:2001:660:3007:123:1234:5678
FF7E:0820:2001:660:3001:104:1234:abcd
fe00::/9
fe80::1234:5678%eth0
fe80::211:bcff:fec0:c800%4
fe80::211:bcff:fec0:d000%4
fec0:0:0:5::2/64
ff1e::2:4444
ff1e::5d:8888
2001:0000:0001:0002:0000:0000:0000:ABCD
2001:0:1:2:0:0:0:ABCD
2001:0:1:2::ABCD
2001:0:aabb:1:2222:3333:4444:5555/64
2001:0:aabb:2::1/64
2001:8:1234:aabb::/64
FE80::21D:A1FF:FE88:33C1
2001:8:1234:AABB:21D:A1FF:FE88:33C1
FE80::21D:A1FF:FE6C:D238
2001:8::21D:A1FF:FE6C:D238
2001:8::/64
2001:0:1:2::/64
2001:0:1:1::1
2001:0:1:1::2/64
2001:0:1:5::2/64
2001:0:1::/80
2001:0:1:1:5::4
2001:0:1::/48
FE80::5EFE:A08:808
2001:1:2:3::/64
2001:1:2:3:0:5EFE:A08:808
fd20:010d:08b5::/48
2001:db8:beef::/48
2001:db8:cafe::/48
fd20:010d:08b5:babe::8:beef
fd20:10d:8b5:babe::8:beef
2001:db8:beef:babe::8:beef
2001:0db8:beef:babe::8:beef
2001:db8:cafe:babe::8:beef
2001:0db8:cafe:babe::8:beef
fd00:0:1::/64
fd00:0:2::/64
64:ff9b::0.0.0.0/96
64:ff9b::203.0.113.50
64:FF9B::192.0.2.33
2001:db8:0:0:1:0:0:1
2001:0db8:0:0:1:0:0:1
2001:db8::1:0:0:1
2001:db8::0:1:0:0:1
2001:0db8::1:0:0:1
2001:db8:0:0:1::1
2001:db8:0000:0:1::1
2001:DB8:0:0:1::1
2001:db8:aaaa:bbbb:cccc:dddd:eeee:0001
2001:db8:aaaa:bbbb:cccc:dddd:eeee:001
2001:db8:aaaa:bbbb:cccc:dddd:eeee:01
2001:db8:aaaa:bbbb:cccc:dddd:eeee:1
2001:db8:aaaa:bbbb:cccc:dddd::1
2001:db8:aaaa:bbbb:cccc:dddd:0:1
2001:db8:0:0:0::1
2001:db8:0:0::1
2001:db8:0::1
2001:db8::1
2001:DB8::1
2001:0db8::0001
2001:db8::aaaa:0:0:1
2001:db8:0:0:aaaa::1
2001:db8:aaaa:bbbb:cccc:dddd:eeee:aaaa
2001:db8:aaaa:bbbb:cccc:dddd:eeee:AAAA
2001:db8:aaaa:bbbb:cccc:dddd:eeee:AaAa
2001:db8::1:0:0:1
2001:db8:0:0:1::1
2001:0db8:0000::/48
2001:0db8:0000:0000:1111:2222:3333:4444
2001:0db8:0000:0000:0000:0000:0000:0001
2001:0db8:0::1
2001:db8:0:0:1:0:0:1
2001:DB8::1:0:0:1
2001:db8:0:1::1
2001:db8::1:0:0:0:1
2001:db8::1:0:1
2001:db8:1::0:1
2001:db8:0:1:1:1:1:1
2001:db8::1:1:1:1:1
2001:db8:0:0:0:0:2:1
2001:db8::2
2001:db8::2:1
2001:db8::0:1
2001:0:0:1:0:0:0:1
2001:db8:0:0:1:0:0:1
2001:db8::1:0:0:1
2001:0db8:0000:0000:1234:0000:0052:0001
2001:0db8:0000:0000:1234::0052:0001
2001:0db8:0:0:1234::52:1
2001:db8::1234:0:51:1
FE11:3CB8:000E:0000:0000:3B00:0230:00A9
FE11:3CB8:E:0:0:3B00:230:A9
FE11:3CB8:E::3B00:230:A9
FE11:3CB8:E:0:0:3B00:230:A9/40
FE11:3CB8:E::3B00:230:A9/40
0000:0000:0000:0000:0000:0000:147.19.1.1
::147.19.1.1
1234:0000:1234:0000:1234:0000:0123:1234
1234:0:1234:0:1234:0:123:1234
1234::1234:0:1234:0:123:1234
1234:0:1234::1234:0:123:1234
1234:0:1234:0:1234::123:1234
1111:0000:0000:1234:0011:0022:0033:0044
1111::1234:11:22:33:44
::D190:4E71
::d190:4E71
::D190:4e71
::d190:4e71
::209.144.78.113
24::24:2
13::/64
13::13:3
13::13:1/64
13::219:55FF:FEF0:B7D0/64
FF02::1
FF02::2
FF02::1:FF13:3
FF02::1:FFF0:B7D0
103::/64
103::3/128
FE80::219:55FF:FEF0:B7D0/10
2002:ac10:6501::/128
2002:ac10:6601::/128
AAAA::1
AAAA::2
AAAA::3
AAAA::4
FF00::A
ABCD:0123:4040:0000:0000:0000:000A:000B
ABCD:123:4040::A:B
b:b:b:b::1/64
b:b:b:b::2/64
A:A:A:A::11/64
B:B:B:B::11/64
1234:5678:9abc:def0::/64
::ffff:192.0.2.1
192.0.2.1
2001:db8:c001:cafe:00c0:2:2100:0
2001:db8:c001:cafe:c0:2:2100:0
2001:db8:1234::80
fd00:dead:beef:1::1
0:0:0:0:0:FFFF:7F00:0/104
FEC0::1234:5678:9ABC
FEC0::1234:5678:9ABC%1
fec0::1234:5678:9abc
fec0::1234:5678:9abc%1
febf::a
FeBf::A
fEbf::a%33
fEBf::a%33
fEBf::a%33/64
fec0::1234%0
fec0::1234%0/64
fec0::fA34%0/64
fe80::1234
ff02::5678
ff08::9abc
fe80::2
fe80::206:98ff:fe00:232%tap0
fe80::230:48ff:fed9:40f5%2
fe80::230:48ff:fed9:40f5%252
fe80::230:48ff:fed9:40f5%em1
fe80::a%en1
fe80::a%25ee1
fe80::201:2eff:fe6c:1234%enp66s0
%%%% no correct IP addresses below this line %%%%
fe80::230:48ff:fed9:40f5%25n%C3%A9t0
127/8
fd00:dead:beef:1::1.http
2001:db8:coo1:cafe:00c0:2:2100:0
2001:db8:coo1:cafe:c0:2:2100:0
[::ffff:192.0.2.1]
[192.0.2.1]
192.0.2.1/255.255.255.0
0:0:0:0:0:FFFF::192.0.2.1
1.1
127.1
123456
10/8
1234:5678:9abc:def0:/64
13:219:55FF;FEF0:B7D0/128
1.-1.2.3
1.2.3
1.2.3/22
1.2.3.4.5
1.2.3.4.5/21
10.0.0.1/33
10.0.0.1/-3
256.1.1.1
1.256.1.1
1.1.256.1
1.1.1.256
10.300.1.2/23
::/-1
:::
:::/3
::::
:0::
:0:::
::/129
2001::db8::/32
2345:2001:0db8:85a3:0000:0000:8a2e:0370:7334
:2001:0db8:85a3:0000:0000:8a2e:0370:7334
2001:0db8:85a3:0000:0000:8a2e:0370:7334:
:2001:0db8:85a3:0000:0000:8a2e:0370:7334:
:0db8:85a3:0000:0000:8a2e:0370:7334
0db8:85a3:0000:0000:8a2e:0370:7334
dead:beaf:0x::
ff05::1::3
FF02::2:FF00:0:/104
2001:0DB8:0:CD3/60
::%0
::%0/128
::1%0
::1%0/128
ff02::5678%
ff08::9abc%
fe80::1234%
ff02::5678%/64
ff08::9abc%/64
fe80::1234%/64
fec0::1234%/64
g::
G::
::12345
12345::
01234:5678:9abc:def0:1234:5678:9abc:def0
1234:05678:9abc:def0:1234:5678:9abc:def0
1234:5678:09abc:def0:1234:5678:9abc:def0
1234:5678:9abc:def0:01234:5678:9abc:def0
1234:5678:9abc:def0:1234:5678:09abc:def0
1234:5678:9abc:def0:1234:5678:9abc:0def0
1234:5678:9abc:def0:1234:05678:9abc:def0
1234:5678:9abc:0def0:1234:5678:9abc:def0
2001:DB8::abf:1::7
2001:0DB8:0000:0000:0abf:0001:0007
2001:DB80:0:1/64
2001:DB80:0:2/64
2001:DB80:0:3/64
200X:
2001:0DB8:417A
2001::0DB8::417A
2001:::0DB8::417A
2001:0DB8:0:0:417A
2001:::0DB8:0:0:417A
192.168.30.1:0:0:0:0:0:0
192.168.30.1::
2031::130F::9C0:876A:130B
2031:0:130F:::9C0:876A:130B
2031::130F:0::9C0:876A:130B
FE80::10::123
FE8::1::123
FF05:2
2340:1111/32
2340:1111:AAAA/48
2340:1111:AAAA:0001/64
FF02:1:2
::ffff:0:0:/96
0000::<smallnumber> 
0080:vvww:yyzz:XXXX/112
0::/0^49-128
2001:0660:2---::/48
2001:0660:300x:/48
2001:0660:xy::/40
2001:0660:{3-F}---::/48
2001:0738:<cutomer id>::/48
2001:660:20xx::/48
2001:660:{3-F}xxx::/48
2001:690:1:1::0E:0CFF:FE31:C81F
2001:XXXX:1:YYYY::1
2001:XXXX:1:YYYY::2
2001:XXXX:YYYY:ZZZZ:/64
2001:XXXX:YYYY:ZZZZ::1
2006:151:2::yyy/64
2006:151:3::xxxx/64
2006:1::xxxx/64
2006:1::yyy/64
::FFFF:IPv4/128
::IPv4/128
::ffff:<ipv4-address>
::ffff:a.b.c.d
FF0X:0:0:0:0:0:0:101
FF0X:0:0:0:0:0:0:109
FF3X::/32
FF3X::/96
FF3x::1234:abcd /96
FF7x::/16
[2001:DB8:3003:2:a00:20ff:fe18:964c]
ff02::1:ffxx:xxxx
FF02::1:FFxx:xxxx
http://[2001:DB8::43]:80/index.html
2005:DEAD:BEEF:0:5EFE:C0A8:C701/64
2005:DEAD:BEEF:0:5EFE:C0A8:C702
0200:5efe:984e:4001
2001:0660:3000:/40
2001:0660:3300:/40
2001:0660:4400:/40
2001:0660:5400:/40
2001::1:2::ABCD
2001:0:1/24
2001:1:2:3/64
Ff02::1:fF00:0:
Ff02::1fF::
Ff02::1:fF::
Ff02::1:fF00::
111::::2222:3333:4444:5555
1111::2222::4444:5555
1111::::2222:3333:4444:5555
1111::2222:3333::
XXXX:XXXX:XXXX:XXXX:XXXX:XXXX:XXXX:XXXX
A:A:A:A::X/64
B:B:B:B::X/64
C:C:C:C::X/64
D:D:D:D::X/64
http://[fe80::206:98ff:fe00:232%tap0]/
[fe80::206:98ff:fe00:232%tap0]
http://[fe80::230:48ff:fed9:40f5%252]
[fe80::230:48ff:fed9:40f5%252]
[fe80::1%251]
http://[fe80::230:48ff:fed9:40f5%25n%C3%A9t0]
[fe80::230:48ff:fed9:40f5%25n%C3%A9t0]
http://[fe80::201:2eff:fe6c:1234%enp66s0]/
[fe80::201:2eff:fe6c:1234%enp66s0]
http://[fe80::a%en1]
[fe80::a%en1]
http://[fe80::a%25en1]
[fe80::a%25en1]
http://[fe80::a-en1]
[fe80::a-en1]
http://[v6.fe80::a_en1]
[v6.fe80::a_en1]
EOAdressen

echo 'Testing the regular expressions using embedded test data.'
total=$(sed '/^%%%%/d' "$TMPFILE" | wc -l)
correct=$(sed '/^%%%% correct/d; /^%%%% no/,$d' "$TMPFILE" | wc -l)
wrong=$(sed '1,/^%%%% no/d' "$TMPFILE" | wc -l)
matched=$(grep -E -o -e "^${IPv4}$" -e "^${IPv6}$" "$TMPFILE" | wc -l)
echo "Testing a total of $total input lines containing $correct IPv4 or IPv6" \
     'addresses.'
echo "Test input contains $wrong lines not describing IPv4 or IPv6 addresses."
echo "The regular expressions match $matched input lines."
ret=0
test $matched -eq $correct ||
  { echo 'The number of matches is wrong.'; ret=1; }
matched=$(sed '/^%%%% correct/d; /^%%%% no/,$d' "$TMPFILE" | \
          grep -E -o -e "^${IPv4}$" -e "^${IPv6}$" | wc -l)
test $matched -eq $correct ||
  { echo "Not all of the correct IPv4 and IPv6 addresses have been matched:"; \
    ret=1; \
    sed '/^%%%% correct/d; /^%%%% no/,$d' "$TMPFILE" | \
    grep -v -E -e "^${IPv4}$" -e "^${IPv6}$"; }
matched=$(sed '1,/^%%%% no/d' "$TMPFILE" | \
          grep -E -o -e "^${IPv4}$" -e "^${IPv6}$" | wc -l)
test $matched -eq 0 &&
  echo 'Matched none of the input lines not describing IPv4 or IPv6 addresses.' ||
  { echo "Matched $matched lines not describing IPv4 or IPv6 addresses:"; \
    ret=1; \
    sed '1,/^%%%% no/d' "$TMPFILE" | \
    grep -E -o -e "^${IPv4}$" -e "^${IPv6}$"; }
test $ret -eq 0 &&
  { echo 'Success: only correct IPv4 and IPv6 addresses have been matched.'; \
    printf -- '\nRegular expression for IPv4 addresses:\n %s\n' "${IPv4}"; \
    printf -- '\nRegular expression for IPv6 addresses:\n %s\n' "${IPv6}"; } ||
  printf -- '\n***\n*** --- %s ---\n***\n\n' 'TEST FAILURE.'

exit $ret
